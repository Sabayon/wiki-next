



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Documentation for Sabayon Linux">
      
      
        <link rel="canonical" href="https://sabayon.github.io/wiki-next/articles/SSH_Single_Signon/">
      
      
        <meta name="author" content="Sabayon">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.0.2">
    
    
      
        <title>SSH Single SignOn (SSO) - Sabayon Wiki</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.982221ab.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.1f0bcf2b.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../extra.css">
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#ssh-single-signon-sso" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://sabayon.github.io/wiki-next/" title="Sabayon Wiki" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Sabayon Wiki
            </span>
            <span class="md-header-nav__topic">
              SSH Single SignOn (SSO)
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/Sabayon/wiki-next/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Sabayon/wiki-next
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://sabayon.github.io/wiki-next/" title="Sabayon Wiki" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Sabayon Wiki
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/Sabayon/wiki-next/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Sabayon/wiki-next
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Contributing
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Contributing
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../documentation/" title="Wiki" class="md-nav__link">
      Wiki
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../irc/" title="IRC|Testers" class="md-nav__link">
      IRC|Testers
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../entropy/" title="Entropy Package Manager" class="md-nav__link">
      Entropy Package Manager
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../howto/" title="How To Index" class="md-nav__link">
      How To Index
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#concept" title="Concept" class="md-nav__link">
    Concept
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#equo-stuff" title="Equo Stuff" class="md-nav__link">
    Equo Stuff
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-key-pair" title="Create Key Pair" class="md-nav__link">
    Create Key Pair
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#distribute-public-key" title="Distribute Public Key" class="md-nav__link">
    Distribute Public Key
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-pam" title="Configure PAM" class="md-nav__link">
    Configure PAM
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/Sabayon/wiki-next/edit/master/docs/articles/SSH_Single_Signon.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="ssh-single-signon-sso">SSH Single SignOn (SSO)</h1>
<h2 id="concept">Concept</h2>
<p>If you work with multiple *nix-based machines via ssh, you are probably tired of constantly having to enter your password every time you want to access another box.  There is a secure way to allow you to access every machine, that you have ssh access to, without having to enter another password (other than the one you signed on with originally.)</p>
<p>This is actually quite simple to do, you basically just create a public/private key pair to authenticate yourself to your other machines, then have PAM spawn an agent to load your keys after you logon, providing a single signon solution to accessing all your remote machines.  This guide will walk you through setting this up.</p>
<h2 id="equo-stuff">Equo Stuff</h2>
<p>First of all, we are going to need the pam_ssh module.  You may already have this installed, if not equo it.  I'm going to assume you already have openssh installed, as every system should.
<pre class="clear"># equo install pam_ssh </pre></p>
<h2 id="create-key-pair">Create Key Pair</h2>
<p>Now we need to create the key pair to authenticate yourself across the network.  To do so, run this as your <strong>regular user</strong>.
<strong><em>WARNING: This should NOT be done as root, and you should never, ever ssh using the root account</em></strong>
<pre class="clear">$ ssh-keygen -t dsa </pre></p>
<p>This will ask where to save the file, just press enter as the default is what we want.  </p>
<p>After that it will ask for the passphrase you want to use.  It is important to <strong><em>set the passphrase to the exact same password as your normal logon password</em></strong> for this user.  This is the password for the user on the current machine, not the one for other machines, even if they differ.</p>
<p>When that is done, two files should of been created <code>~/.ssh/id_dsa</code> and <code>~/.ssh/id_dsa.pub</code> .<br />
<strong><em>NOTE: It is very important to keep <code>~/.ssh/id_dsa private</code>, it should be only readable by your user, to make sure of this, run this command:</em></strong>
<pre class="clear">$ chmod 600 ~/.ssh/id_dsa </pre></p>
<h2 id="distribute-public-key">Distribute Public Key</h2>
<p>Now we need to give all of our remote machines our public key so we can use it to authenticate.  This is very simple to do, run the following command as your user for each remote system you want to setup the passwordless authentication for.
<pre class="clear">$ ssh-copy-id -i ~/.ssh/id_dsa.pub username@remotehostname </pre></p>
<h2 id="configure-pam">Configure PAM</h2>
<p>We need to tell PAM to use our logon password to spawn an ssh-agent and load the rsa key we just made.  There are two lines for <code>pam_ssh.so</code> we need to add, so your system-auth should look something like this:
<code>/etc/pam.d/system-auth</code>
<pre class="clear">
auth       required     pam_env.so</p>
<h1 id="add-this-line-here">Add this line here</h1>
<p>auth       sufficient   pam_ssh.so</p>
<p>auth       sufficient   pam_unix.so try_first_pass likeauth nullok
auth       required     pam_deny.so</p>
<p>account    required     pam_unix.so</p>
<p>password   required     pam_cracklib.so difok=2 minlen=8 dcredit=2 ocredit=2 try_first_pass retry=3
password   sufficient   pam_unix.so try_first_pass use_authtok nullok md5 shadow
password   required     pam_deny.so</p>
<p>session    required     pam_limits.so
session    required     pam_unix.so</p>
<h1 id="add-this-line-to-the-end">Add this line to the end</h1>
<p>session    optional     pam_ssh.so
</pre></p>
<h2 id="summary">Summary</h2>
<p>That's all we need to do, you should be able to logout and log back in with the ability to ssh to your remote hosts without a password. You may need to restart your login manager with <code>systemctl restart lightdm</code> or simply reboot.</p>
<p><strong><em>WARNING: This WILL remove some aspect of physical security on whatever machine you set this up on.  If physical security is a concern, please use a locking screensaver or logout whenever you leave your system unattended.  This is something you should do anyway to protect your local machine from malicious passersby</em></strong></p>
<h2 id="troubleshooting">Troubleshooting</h2>
<p>If you are having problems creating or distributing your keys, take a look at 
http://gentoo-wiki.com/SECURITY_SSH_without_a_password for more information on that task.</p>
<p>If you are still prompted for a password after completing this guide, there are a few files that you may need to check.  Make sure both of these entries are set to "yes" on your remote hosts. 
<code>/etc/ssh/sshd_config</code>
<pre class="clear"></p>
<h1 id="allow-identity-auth-for-ssh1">Allow Identity Auth for SSH1?</h1>
<p>RSAAuthentication yes</p>
<p># Allow Identity Auth for SSH2?
 PubkeyAuthentication yes
</pre></p>
<p>Make sure these entries are in your local machine's config.
<code>/etc/ssh/sshd_config</code>
<pre class="clear">Host * 
Port 22
IdentityFile ~/.ssh/id_dsa
</pre></p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.d9aa80ab.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>